var ANTIGUA_TEXT = "<p>Originally colonized by England in 1632, Antigua is a Caribbean island with a profoundly revelatory historical " +
  "landscape that includes, along with the other islands of the region, a legacy of centuries of enslavement, " +
  "oppression, exploitation, and murder of Africans and people of African descent. Many scholars of the Caribbean, " +
  "have written about the plantation, specifically the sugar mill, as the primary symbol of the enterprise, " +
  "of the machinery that created and sustained European colonization, empire, and economic prosperity for generations, " +
  "while, at the same time, decimating black lives and bodies, contorted to support the production of sugar. " +
  "The sugar mill factory was the technological implement of the Caribbean plantation and was the mechanism " +
  "through which sugar, whose worth throughout the peak centuries of Caribbean sugar cane production, was equivalent " +
  "to the value of crude oil today. In contemporary times, the Antiguan landscape is marked with the physical " +
  "markers of the brutal and perfidious realities of the plantation in the form of the remnants of the windmills " +
  "that were used for centuries to process sugarcane on the island.</p>" +
  "<p>According to the 2013 report of the Museum of Antigua and Barbuda, there are more than 200 windmill bases extant " +
  "on the island. The Museum of Antigua and Barbuda has been engaged in documenting the sugar mills of Antigua " +
  "in conjunction with the especial work of independent scholar <a href='interview.pdf'> Agnes Meeker</a>. Her years of field work and research " +
  "instigated the idea of using her work to digitize, map, and historicize each of the mills electronically " +
  "for access to scholars and for lay people interested in studying Antiguan and Caribbean histories, as well " +
  "as for tourists visiting the islandâ€”The Antigua Sugar Mills Project.</p>";

var CREDITS_TEXT = "<p>The Bucknell University Griot Institute for Africana Studies Antigua Sugar Mills project is grounded entirely on the decades-long work and research of <a href='interview.pdf'> Agnes Meeker</a>, an independent researcher and lay historian whose passion has been gathering information on the sugar mills and plantations of the island.</p>" +
  "<p>While in Antigua, in 2016 with Bucknell in the Caribbean students, during a tour with a local professor, we learned about the important work the Museum of Antigua and Barbuda has been engaged in documenting the sugar mills of Antigua. That encounter instigated the idea of digitizing, mapping, and historicizing each of the mills electronically for access to scholars and for lay people interested in studying Antiguan and Caribbean histories, as well as for tourists visiting the island.</p>" +
  "<p>In partnership with Bucknell&rsquo;s Digital Humanities staff, the Museum of Antigua and Barbuda, <a href='interview.pdf'> Agnes Meeker</a>, and Bucknell students, this website is the manifestation of that scholarly and pedagogical project.</p>" +
  "<p>Special thanks go to <a href='interview.pdf'> Agnes Meeker</a> and to the <a href='http://www.antiguamuseums.net/'>Museum of Antigua and Barbuda.</a></p>" +
  "<p>The project would not have materialized so expertly and eloquently without the hard work and passion of Bucknell&rsquo;s expert engineering and computer science team Khoi Le &rsquo;18, Patrick Newhart &rsquo;18, Khai Nguyen &rsquo;18, and Alexander Murph &rsquo;18.</p>" +
  "<p>About the project, they have written, &ldquo;In just the few paragraphs provided in the proposal submitted by the Griot, we were all entranced by Antigua. In our minds, Antigua is a place deserving of attention: a place that should be shared in a beautiful and creative way. We would say that the main motivating factor of our involvement has been this interest in Antigua&rsquo;s history, and a respect for the noble cause of presenting what has been a long history of colonialism, slavery, and African diaspora. We wanted to help the Griot Institute achieve this goal.&rdquo;</p>" +
  "<p>Also instrumental to the manifestation and success of the Antigua Sugar Mills map project are the following individuals: Diane Jackaki, Sam Lauer, Michelle Lauver, Eddie Lopez, Sarah Rosecky, Annie Girton, Christine Cha, Amber Quinlan, students from Bucknell in the Caribbean.</p>" +
  "<p>Thanks to all.</p>" +
  "<p>If you have information that could be included in this project or have questions, please contact Carmen Gillespie at griot@bucknell.edu</p>";

var BLIBLIO_TEXT = "<p><strong>For more information about Antigua, some selected texts.</strong></p><p>&nbsp;<em>A</em>&nbsp;<em>History of Antigua: The Unsuspected Isle</em>. Brian Dyde. London and Basingstoke:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Macmillan Caribbean, 2000.</p><p><em>Antigua And The Antiguans: A Full Account Of The Colony And Its Inhabitants</em></p><p><em>&nbsp;From The Time Of The Caribs To The Present Day, Interspersed With Anecdotes </em></p><p><em>And Legends.&nbsp; </em>Mrs. [Frances T.] Lanaghan. London: Saunders &amp; Otley, 1844.</p><p>Reprinted, London: Spottiswoode, Ballantyne &amp; Co., 1967. 2 vols.</p><p><em>An Antigua Plantation, 1769-1818</em>. Ulrich B. Phillips. North Carolina Historical Review,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vol. 3, no. 3 (1926), p. 439-45.</p><p>&ldquo;The Antigua Slave Conspiracy Of 1736: A Case Study Of The Origins Of Collective</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Resistance.&rdquo; David Barry Gaspar. William and Mary Quarterly, vol. 35, no. 2</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (April 1978), p. 308-23.</p><p><em>Betty's Hope: An Antiguan Sugar Plantation.&nbsp;&nbsp; </em>Birgit Carstensen. St. John's, Antigua:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Betty's Hope Trust, 1993.</p><p><em>Bondmen And Rebels: A Study Of Master-Slave Relations In Antigua. </em>David Barry</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gaspar. Baltimore, Maryland: The Johns Hopkins University Press, 1985.</p><p><em>A Brief Account Of The Island Of Antigua, Together With The Customs And</em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Manners Of Its Inhabitants, As Well White As Black: As Also An Accurate </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Statement Of The Food, Cloathing, Labour, And Punishment Of Slaves. In </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Letters To A Friend. Written In The Years 1786, 1787, 1788. </em>John Luffman.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; London: Printed by T. Cadell, 1789.</p><p><em>Four Years' Residence In The West Indies, During The Years 1826, 1827,</em></p><p><em>1828, 1829. </em>F.W.N. (Frederick William Naylor) Bayley. London: William Kidd,</p><p><em>A Genuine Narrative Of The Intended Conspiracy Of The Negroes At Antigua. </em>Dublin:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Printed by and for R. Reilly, 1737; rept. ed., New York: Arno Press, 1971.</p><p><em>An Historical And Descriptive Account Of Antigua, Illustrated By Numerous Engravings, Coloured In Imitation Of Drawings Taken On The Spot, Delineating The Character Of The Country, The Costume Of The Negroes, &amp;C. Accompanied By A Map Of The Island ... And A Chronological Table Of Events Connected With The Colony.</em> J. Johnson. London: Printed for the author, 1830.</p><p><em>The History Of Mary Prince, A West Indian Slave. Related By Herself. </em>Mary Prince,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; with a supplement by the editor. Edited by Thomas Pringle. London: F. Westley</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; A.H. Davis, 1831.</p><p>&ldquo;&lsquo;A Mockery Of Freedom': The Status Of Freedmen In Antigua Slave Society Before</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1760.&rdquo;&nbsp; David Barry Gaspar. Nieuwe West-Indische Gids/New West Indian</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Guide, vol. 59, nos. 3-4 (1985), p. 135-48.</p><p>Nelson's Letters From The Leeward Islands And Other Original Documents In The &nbsp;&nbsp;&nbsp;&nbsp; Public Records Office And The British Museum. Edited by Geoffrey Rawson.</p><p>&ldquo;Planters And Merchants: The Oliver Family Of Antigua And London, 1716-1784.&rdquo;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Richard B. Sheridan. Business History, vol. 13, no. 2 (1971), p. 104-113.</p><p>The Rise Of A Colonial Gentry: A Case Study Of Antigua, 1730-1775. R. B. Sheridan.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Economic History Review, 2d series, vol. 13, nos. 1-3 (1960-1961), p. 342-57.</p><p>Samuel Martin, Innovating Sugar Planter Of Antigua, 1750-1776. Richard B. Sheridan.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Agricultural History, vol. 34, no. 3 (July 1960), p. 126-39.</p><p><em>Six Months In The West Indies, In 1825. </em>Henry Nelson Coleridge. London: John</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Murray, 1826; rept. ed., New York:&nbsp; Negro Universities Press, 1970.</p><p>&ldquo;Slave Importation, Runaways, And Compensation In Antigua, 1720-1729.&rdquo; <em>&nbsp;</em>David Barry</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gaspar. In: <em>The Atlantic Slave Trade: Effects On Economies, Societies, And </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Peoples In Africa, The Americas, And Europe</em>. Edited by Joseph E. Inikori</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Stanley L. Engerman. Durham &amp; London: Duke University Press, 1992,</p><ol start='320'><li>301-320.</li></ol><p><em>Slavery, Amelioration, And The Sunday Markets In Antigua, 1823-1831. </em>David Barry</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gaspar. Slavery &amp; Abolition, vol. 9, no. 1 (May 1988), p. 1-28.</p><p>&lsquo;To Bring Their Offending Slaves To Justice': Compensation And Slave Resistance</p><p>&nbsp;In Antigua, 1669-1763.&rdquo; David Barry Gaspar. Caribbean Quarterly, no. 30, nos.</p><p>3-4 (September-December 1984), p. 45-59.</p><p><em>Working The System: Antigua Slaves And Their Struggle To Live. </em>David Barry Gaspar.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Slavery &amp; Abolition, vol. 13, no. 3 (December 1992), p. 131-55.</p><p><em>The Growth Of The Modern West Indies. </em>Gordon K. Lewis. London: MacGibbon &amp; Kee;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; New York: Monthly Review Press, 1968.</p><p><em>Emancipation In The West Indies. A Six Months' Tour In Antigua, Barbados, And </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Jamaica, In The Year 1837. </em>Jas. A. Thome, J. Horace Kimball. New York: The</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; American Anti-Slavery Society, 1838.</p><p><em>An Essay On Yellow Fever, Comprising The History Of That Disease, As It Appeared In </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The Island Of Antigua, In The Years 1835, 1839, And 1842, With An Appendix </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Continuing The History To 1853. </em>Thomas Nicholson, M.D. London, John</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Churchill &amp; Sons, 1866.</p><p><em>Five Years' Residence In The West Indies.</em>Charles William Day. London: Colburn &amp; Co.,</p><ol start='1852'><li>2 vols.</li></ol><p><em>From A Colonial Governor's Note-Book. </em>T. Reginald St.-Johnston. London: Hutchinson</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; Co., Ltd., 1936; rept. ed., New York: Negro Universities Press, 1970.</p><p><em>From Columbus to Castro: The History of the Caribbean, 1492-1969</em>. Eric Williams.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; London: Andre Deutsch, 1970.&nbsp;</p><p><em>From An Antiguan's Notebook. </em>Charlesworth Ross. Barbados: Advocate Commercial</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Printing, 1962.</p><p>John Candler's Diary. Edited by Prof. J. Borom. Caribbean Studies, vol. 5, no. 3</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (October 1965), p. 51-57.</p><p><em>Lasting Legacy: A Story Of British Colonialism.&nbsp; </em>Sir Kenneth Blackburne. London:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Johnson Publications, 1976.</p><p><em>Letters from the West Indies: relating especially to the Danish island St. Croix, and to </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the British islands Antigua, Barbadoes, and Jamaica. </em>Sylvester Hovey. New</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; York: Gould &amp; Newman, 1838.</p><p><em>The Ordeal Of Free Labor In The British West Indies. </em>William G. Sewell. New York:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Harper &amp; Brothers; London: Sampson Low &amp; Co., 1861.</p><p><em>A Treatise On The West Indian Encumbered Estates Act. </em>Reginald John Cust. London:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; William Amer, 1859.</p><p><em>The West Indies In 1837. </em>Joseph Sturge, Thomas Harvey. London: Hamilton, Adams, &amp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Co., 1838; reprinted, London: Wm. Dawson &amp; Sons, 1968.</p><p>The West Indies, Before And Since Slave Emancipation. John Davy, M.D. London: W. &amp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; F.G. Cash, 1854.</p><p><em>A Winter In The West Indies, Described In Familiar Letters To Henry Clay, Of </em></p><p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Kentucky. </em>John Joseph Gurney. London: John Murray, 1841.</p><p><strong>&nbsp;</strong></p>";

var STJOHN_TEXT = "<p>St. Johnâ€™s is a parish on the northwest corner of Antigua. Its capital is St. John, and the parish has the largest population of any Antiguan parish of 49,225 as of the 2011 census.</p>";

var STGEORGE_TEXT = "<p>St. Georgeâ€™s is a parish in northcentral Antigua. Its capital is Piggots, and the parishesâ€™ population was 7,496 as of the 2011 census.</p>";

var STMARY_TEXT = "<p>St. Maryâ€™s is a parish in southwest Antigua. Its capital is Bolans, and the parishesâ€™  population was 7,067 as of the 2011 census.</p>";

var STPHILIP_TEXT = "<p>St. Philipâ€™s is a parish in northeast Antigua. Its capital is Carlisle, and the parishesâ€™  population was 3,125 as of the 2011 census.</p>";

var STPETER_TEXT = "<p>St. Peterâ€™s is a parish in northcentral Antigua. Its capital is Parham, and the parishesâ€™  population was 5,269 as of the 2011 census.</p>";

var STPAUL_TEXT = "<p>St. Paulâ€™s is a parish in southcentral Antigua. Its capital is Falmouth, and the parishesâ€™  population was 7,979 as of the 2011 census.</p>";


$(document).ready(function () {
  // -------------- VARIABLE DECLARATION --------------------

  // the map which is currently active and show on the screen. jquery object
  var $current_map;
  // The name of the current map. Use for functions which require current map information
  // possible value: stgeorge|stmary|stpaul|stpeter|stphilip|stjohn|antigua
  var current_map;
  // the array of all parishes
  var parishes_array = [];
  // the aray of all mills
  var mills_array = [];
  // the dictionary of all mills, sorted according to parishes
  var mills_by_parishes_array = {};
  // the array of all mills we are currently working with
  var current_mills_array = [];
  //   var mill_locaitons, which contains all location data of mills. Declared in mill_location.json file
  // var mill_data, which contains all data of mills. Declared in mill_data.js file
  // the new variable to content mill data. Use dictionary type for easy reference
  var new_mill_data = {};

  // -------------- MENU BUTTONS STYLING AND FUNCTIONS ---------------------

  /**
   * Menu button styling on mouse over
   */
  $(".menu_button").on("mouseover", function () {
    $(this).css("border", " 1px ridge rgba(242, 207, 141, 1)");
  });

  // menu item click
  $(".menu_button").on("click", function () {
    // Calculate the dropdown length of parish and mill list so that they dont go over the screen
    var distance_to_bottom =
      $(window).height() -
      $("#credit_button")[0].getBoundingClientRect().bottom -
      $("#credit_button").outerHeight();
    $(".expandable_list", this).css({
      height: distance_to_bottom.toString(),
      "margin-top": "2em"
    });
    if ($(".menu_title", this).attr("id") !== "info_button") {
      if ($(".menu_title", this).attr("id") !== "map_button") {
        if ($(".menu_title", this).attr("id") !== "biblio_button") {
          if ($(".menu_title", this).attr("id") !== "credit_button") {
            $(".menu_title", this).css({
              "border-bottom": "1px ridge rgba(242, 207, 141, 1)"
            });
          }
        }
      }
    }
  });

  /**
   * Menu button styling on mouse leave
   */
  $(".menu_button").on("mouseleave", function () {
    $(this).css("border", " 1px ridge transparent");
    $(".expandable_list", this).css({
      height: "0vh",
      "margin-top": "0"
    });
    $(".menu_title", this).css({
      "border-bottom": "none"
    });
  });

  /**
   * What to do when info button is clicked. Doesn't require any data from .js file
   */
  $("#info_button").on("click", function () {
    if (!$("#middle-slide").hasClass("active")) {
      $("#middle-slide").addClass("active");
      $("#middle-slide-title").addClass("active");
      $("#middle-slide-content").addClass("active");
      switch ($current_map.attr('id')) {
        case "antigua_map":
          $("#middle-slide-content").html(ANTIGUA_TEXT);
          $("#middle-slide-title").html("Sugar Mill Project");
          break;
        case "stjohn_map":
          console.log("yay");
          $("#middle-slide-content").html(STJOHN_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        case "stpaul_map":
          $("#middle-slide-content").html(STPAUL_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        case "stpeter_map":
          $("#middle-slide-content").html(STPETER_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        case "stmary_map":
          $("#middle-slide-content").html(STMARY_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        case "stgeorge_map":
          $("#middle-slide-content").html(STGEORGE_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        case "stphilip_map":
          $("#middle-slide-content").html(STPHILIP_TEXT);
          $("#middle-slide-title").html("About the Parish");
          break;
        default:
          break;
      }
    } else if ($("#middle-slide").hasClass("active")) {
      if ($("#middle-slide-title").html() === "Credits" || $("#middle-slide-title").html() === "Bibliography") {
          switch ($current_map.attr('id')) {
              case "antigua_map":
                  $("#middle-slide-content").html(ANTIGUA_TEXT);
                  $("#middle-slide-title").html("Sugar Mill Project");
                  break;
              case "stjohn_map":
                  $("#middle-slide-content").html(STJOHN_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              case "stpaul_map":
                  $("#middle-slide-content").html(STPAUL_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              case "stpeter_map":
                  $("#middle-slide-content").html(STPETER_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              case "stmary_map":
                  $("#middle-slide-content").html(STMARY_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              case "stgeorge_map":
                  $("#middle-slide-content").html(STGEORGE_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              case "stphilip_map":
                  $("#middle-slide-content").html(STPHILIP_TEXT);
                  $("#middle-slide-title").html("About the Parish");
                  break;
              default:
                  break;
          }
      } else {
        $("#middle-slide").removeClass("active");
        $("#middle-slide-title").removeClass("active");
        $("#middle-slide-content").removeClass("active");
      }
    }
  });

  $("#credit_button").on("click", function () {
    if (!$("#middle-slide").hasClass("active")) {
      $("#middle-slide").addClass("active");
      $("#middle-slide-title").addClass("active");
      $("#middle-slide-content").addClass("active");
      $("#middle-slide-content").html(CREDITS_TEXT);
      $("#middle-slide-title").html("Credits");
    } else if ($("#middle-slide").hasClass("active")) {
      if ($("#middle-slide-title").html() !== "Credits") {
        $("#middle-slide-content").html(CREDITS_TEXT);
        $("#middle-slide-title").html("Credits");
      } else {
        $("#middle-slide").removeClass("active");
        $("#middle-slide-title").removeClass("active");
        $("#middle-slide-content").removeClass("active");
      }
    }
  });

  $("#biblio_button").on("click", function () {
    if (!$("#middle-slide").hasClass("active")) {
      $("#middle-slide").addClass("active");
      $("#middle-slide-title").addClass("active");
      $("#middle-slide-content").addClass("active");
      $("#middle-slide-content").html(BLIBLIO_TEXT);
      $("#middle-slide-title").html("Bibliography");
    } else if ($("#middle-slide").hasClass("active")) {
      if ($("#middle-slide-title").html() !== "Bibliography") {
        $("#middle-slide-content").html(BLIBLIO_TEXT);
        $("#middle-slide-title").html("Bibliography");
      } else {
        $("#middle-slide").removeClass("active");
        $("#middle-slide-title").removeClass("active");
        $("#middle-slide-content").removeClass("active");
      }
    }
  });

  // -------------- INIT CALLS. RUN WHEN WEBSITE STARTS ---------------------

  // show main map and hide other maps. We have to do this because they live on the same page
  $("#stjohn_map").hide();
  $("#stgeorge_map").hide();
  $("#stmary_map").hide();
  $("#stpaul_map").hide();
  $("#stpeter_map").hide();
  $("#stphilip_map").hide();
  $("#antigua_map").show();
  $current_map = $("#antigua_map");

  // Process mill data into different form.
  // Specifically, we need a list of mill names | a list of parishes name | a list of mill names based on parishes
  for (var index in mill_data) {
    var a_mill = mill_data[index];
    a_mill.true_name = a_mill.name;
    a_mill.name = a_mill.name.replace(/\s+/g, '');
    var display_name = a_mill.display_name;
    var mill_name = a_mill.name;
    // only add in if mill have enough information
    if (display_name != "") {
      mills_array.push(mill_name);
      new_mill_data[mill_name] = a_mill;
    }
  }
  console.log(new_mill_data);

  // load the mills into parish dictionary
  /**
   * Load mills into a dict.
   * @param {*} parish
   * @param {*} mill_by_parish_var
   */
  function add_mills_to_parish_dic(parish, mill_by_parish_var) {
    var parish_has_info = false;
    mills_by_parishes_array[parish] = [];
    for (var index in mill_by_parish_var) {
      var a_mill = mill_by_parish_var[index];
      a_mill.name = a_mill.name.replace(/\s+/g, '');
      var mill_name = a_mill.name;
      if (mill_name in new_mill_data) {
        mills_by_parishes_array[parish].push(mill_name);
        parish_has_info = true;
        new_mill_data[mill_name].parish = parish;
      }
    }
    if (parish_has_info) {
      parishes_array.push(parish);
    }
  }
  add_mills_to_parish_dic("stjohn", stjohn_mill_locations);
  add_mills_to_parish_dic("stgeorge", stgeorge_mill_locations);
  add_mills_to_parish_dic("stmary", stmary_mill_locations);
  add_mills_to_parish_dic("stpeter", stpeter_mill_locations);
  add_mills_to_parish_dic("stpaul", stpaul_mill_locations);
  add_mills_to_parish_dic("stphilip", stphilip_mill_locations);

  // sort the mill names inside the list
  mills_array.sort();
  parishes_array.sort();
  for (var key in mills_by_parishes_array) {
    mills_by_parishes_array[key].sort();
  }

  // start with main map, current list of mills is list of all mills
  current_mills_array = mills_array;

  // add mills to menu. start with all mills
  add_mills_to_menu();

  // ------------------ MAIN FUNCTIONS --------------------------

  /**
   * Capitalize the first character of a string
   * @param {*} s: string to convert
   */
  String.prototype.capitalizeFirstLetter = function () {
    return this.charAt(0).toUpperCase() + this.slice(1).toLowerCase();
  };

  // add parishes to menu
  var $parish_list = $("#parish_list");
  for (var a_parish of parishes_array) {
    // Convert name to propername
    var parish_name =
      a_parish.substring(0, 2).capitalizeFirstLetter() +
      "." +
      a_parish.substring(2).capitalizeFirstLetter();
    var t = jQuery("<div/>", {
      id: a_parish,
      class: "menu_list_item parish",
      text: parish_name
    });
    t.appendTo($parish_list);
    t.hover(
      function () {
        var parish_path_id = "#" + this.id + "-path";
        $(parish_path_id)[0].style.fill = "rgba(0, 0, 0, 0.5)";
      },
      function () {
        var parish_path_id = "#" + this.id + "-path";
        $(parish_path_id)[0].style.fill = "rgba(0, 0, 0, 0)";
      }
    );
    t.click(function () {
      $("#middle-slide").removeClass("active");
      $("#middle-slide-title").removeClass("active");
      $("#middle-slide-content").removeClass("active");
      var parish_path_id = "#" + this.id + "-path";
      $(parish_path_id).trigger("click");
    });
  }

  /**
   * Add list of mills to menu based on the current map.
   * Depends on global current_mills_array
   */
  function add_mills_to_menu() {
    // get element which contains the list in html
    var $mill_list = $("#mill_list");
    // add list of mills to html element
    $mill_list.empty();
    for (mill_name of current_mills_array) {
      var t = jQuery("<div/>", {
        id: mill_name,
        class: "menu_list_item mill",
        text: new_mill_data[mill_name].display_name
      });
      t.appendTo($mill_list);
      t.hover(
        function () {
          var mill_id = "#" + mill_name.id + "_marker";
        },
        function () {
          var parish_path_id = "#" + mill_name.id + "-path";
        }
      );
      t.click(function () {
        $("#middle-slide").removeClass("active");
        $("#middle-slide-title").removeClass("active");
        $("#middle-slide-content").removeClass("active");
        if ($current_map[0] == $("#antigua_map")[0]) {
          var parish = new_mill_data[mill_name].parish;
          var parish_path_id = "#" + parish + "-path";
          $(parish_path_id).trigger("click");
          var mill_id = "#" + mill_name + "_marker";
          $(mill_id)[0].click();
        } else {
          var mill_id = "#" + mill_name + "_marker";
          $(mill_id)[0].click();
        }
      });
    }
  }

  /**
   * Create mill markers on a parish from a location json file
   * @param {*} location_array: the json object holding the location data
   */
  function create_mill_marker(location_array) {
    var $marker = $(".marker.blueprint");
    var new_marker;
    for (var i in location_array) {
      if (mills_array.indexOf(location_array[i].name) != -1) {
        new_marker = $marker.clone();
        new_marker.removeClass("blueprint");
        new_marker.attr("id", location_array[i].name + "_marker");
        var left = location_array[i].left.toString() + "%";
        var top = location_array[i].top.toString() + "%";
        new_marker.css("left", left);
        new_marker.css("top", top);
        new_marker.append("<div class='label'>" + new_mill_data[location_array[i].name].display_name + "</div>");
        $current_map.append(new_marker);
      }
    }
    $(".marker").bind("click", function () {
      var t = $(this)[0];
      $(".card").addClass("active");
      $(".card").attr("id", t.id);
      $(".marker").each(function () {
        if ($(this)[0] != t) {
          $(this).addClass("inactive");
        }
      });
      var element = $(".content-text")[0];
      var mill_name = t.id.replace("_marker", "");
      var a_mill = new_mill_data[mill_name];
      var display_name = a_mill.display_name;
      var a_parish = a_mill.parish;
      var parish_name =
        a_parish.substring(0, 2).capitalizeFirstLetter() +
        "." +
        a_parish.substring(2).capitalizeFirstLetter();
      var extant = a_mill.extant_or_ruin;
      var founding_date = a_mill.date_of_establishment;
      var lat = a_mill.lat;
      var long = a_mill.long;
      $(".card .title")[0].innerHTML = display_name;
      $(".card .subtitle")[0].innerHTML = extant;
      element.innerHTML =
        "This mill was founded in <b>" +
        founding_date +
        "</b>. It belongs to <b>" +
        parish_name +
        "</b> parish, and it's precise GPS location is <b>" +
        long +
        "</b> longitude and <b>" +
        lat +
        "</b> latitude.";
    });
  }

  // ------------------ INTERACTIVE FUNCTIONS --------------------------

  // highlight parishes when hover over
  $(".parish-path").hover(
    function () {
      this.style.fill = "rgba(0, 0, 0, 0.5)";
    },
    function () {
      this.style.fill = "rgba(0, 0, 0, 0)";
    }
  );

  /**
   * switch to different parishes on click
   */
  $("#stjohn-path").on("click", function () {
    $(".card").removeClass("active");
    $(".sidepanel-title").html("St. John");
    $current_map.fadeOut();
    $("#stjohn_map").fadeIn();
    $current_map = $("#stjohn_map");
    create_mill_marker(stjohn_mill_locations);
    current_mills_array = mills_by_parishes_array["stjohn"];
    add_mills_to_menu();
  });

  $("#stpaul-path").on("click", function () {
    $(".card").removeClass("active");
    $(".sidepanel-title").html("St. Paul");
    $current_map.fadeOut();
    $("#stpaul_map").fadeIn();
    $current_map = $("#stpaul_map");
    create_mill_marker(stpaul_mill_locations);
    current_mills_array = mills_by_parishes_array["stjohn"];
    add_mills_to_menu();
  });

  $("#stpeter-path").on("click", function () {
    $(".sidepanel-title").html("St. Peter");
    $(".card").removeClass("active");
    $current_map.fadeOut();
    $("#stpeter_map").fadeIn();
    $current_map = $("#stpeter_map");
    create_mill_marker(stpeter_mill_locations);
    current_mills_array = mills_by_parishes_array["stjohn"];

    add_mills_to_menu();
  });

  $("#stphilip-path").on("click", function () {
    $(".sidepanel-title").html("St. Philip");
    $(".card").removeClass("active");
    $current_map.fadeOut();
    $("#stphilip_map").fadeIn();
    $current_map = $("#stphilip_map");
    create_mill_marker(stphilip_mill_locations);
    current_mills_array = mills_by_parishes_array["stphilip"];
    add_mills_to_menu();
  });

  $("#stmary-path").on("click", function () {
    $(".sidepanel-title").html("St. Mary");
    $(".card").removeClass("active");
    $current_map.fadeOut();
    $("#stmary_map").fadeIn();
    $current_map = $("#stmary_map");
    create_mill_marker(stmary_mill_locations);
    current_mills_array = mills_by_parishes_array["stmary"];
    add_mills_to_menu();
  });

  $("#stgeorge-path").on("click", function () {
    $(".sidepanel-title").html("St. George");
    $(".card").removeClass("active");
    $current_map.fadeOut();
    $("#stgeorge_map").fadeIn();
    $current_map = $("#stgeorge_map");
    current_mills_array = mills_by_parishes_array["stgeorge"];
    create_mill_marker(stgeorge_mill_locations);
    add_mills_to_menu();
  });

  /**
   * What to do when map button is clicked.
   *
   */
  $("#map_button").on("click", function () {
    $(".sidepanel-title").html("Antigua");
    $(".card").removeClass("active");
    $current_map.fadeOut();
    $("#antigua_map").fadeIn();
    $current_map = $("#antigua_map");
    current_mills_array = mills_array;
    add_mills_to_menu();
    if ($("#middle-slide").hasClass("active")) {
      $("#middle-slide").removeClass("active");
      $("#middle-slide-title").removeClass("active");
      $("#middle-slide-content").removeClass("active");
    }
  });

  var $card = $(".blueprint .card");
  var $modal = $(".blueprint .modal");

  $(".card .button-secondary").on("click", function () {
    $(".card").removeClass("active");
    $(".marker").removeClass("inactive");
  });

  $(".card .button-primary").on("click", function () {
    show_full_info();
  });

  /**
   * Show the modal with all the information
   */
  function show_full_info() {
    var modal = $(".modal");
    var element = $(".card")[0];
    var mill_name = element.id.replace("_marker", "");
    var a_mill = new_mill_data[mill_name];
    var a_mill = new_mill_data[mill_name];
    var display_name = a_mill.display_name;
    var a_parish = a_mill.parish;
    var parish_name = a_parish
      .substring(0, 2)
      .capitalizeFirstLetter() + "." + a_parish
      .substring(2)
      .capitalizeFirstLetter();

    var extant = a_mill.extant_or_ruin;
    var founding_date = a_mill.date_of_establishment;
    var lat = a_mill.lat;
    var long = a_mill.long;
    var description = a_mill.additional_info;
    var chronology = a_mill.chronology;
    // update name
    $(".modal-title")[0].innerHTML = display_name;
    // update general info
    $(".modal-genInfo")[0].innerHTML =
      "<b>Type: </b>" +
      extant +
      "<br> <b>Parish: </b>" +
      parish_name +
      " <br> <b>Founding date: </b>" +
      founding_date +
      "<br> <b>Long, lat: </b>" +
      long +
      ", " +
      lat;
    // update description
    $(".modal-desc")[0].innerHTML = description;
    // update the chronology
    // clear the ul content
    $(".timeline").empty();
    for (var year in chronology) {
      $(".timeline").append(
        $("<li>")
        .attr({
          class: "event",
          "data-date": year.toString()
        })
        .append($("<p>").text(chronology[year]))
      );
    }

    $("#Images").empty();
    $("#Images").html("<img src='ResearchersGUI/Mill_Files/Photos/Archbolds.jpeg' style = 'width:100%; heigh:auto;'>");
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    modal.css("transform", "translateY(0)");

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      modal.css("transform", "translateY(100%)");
    };
  }
});
/**
 * Switch to another tab with tab_name in the modal
 * @param {*Ch} evt
 * @param {*} tab_name: the tab to switch to
 */
function change_tab(evt, tab_name) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tab_name).style.display = "block";
  evt.currentTarget.className += " active";
}